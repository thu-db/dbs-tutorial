# 3.2 索引结构-B树和B+树
B树在先修课程《数据结构》中做过讲解，这里不再赘述。索引结构中我们重点介绍B+树。

## B+树概述
m 阶B+树具有如下特征：

1. 每个结点的关键字个数与孩子个数相等，所有非最下层的结点的关键字是对应子树上的最大关键字。

2. 除根结点以外，每个内部结点的孩子数属于 [(m+1)/2, m]。 

3. 最下层结点（叶结点）包含了全部“键-值”对，叶结点可以按照键值从小到大连成单向或双向的链表。

在数据库索引中，每页作为一个结点，是否叶结点、叶结点链表等数据可以存储在页头中。非叶结点要存储若干个 (关键字, 孩子页号) 结构，叶结点要存储若干个 (关键字, 表页号, 表页内槽号) 结构，这种结构可以像表内一条记录一样存储。

### 查找
给定待查找的关键字，对每个结点找到不小于该关键字的第一项。从根结点开始对每个途经结点重复上述过程，并选择键值对应孩子页为下一个查找结点，从而在索引中找到该关键字的下界所在的叶结点。查找某个关键字范围 [a, b] 内的记录可以先找到关键字 a，然后沿叶结点链表顺序查找，直到某个叶结点存在大于b的关键字。

### 插入
给定待插入记录的关键字，可以插入到其下界所在的叶结点。如果叶结点最大键值改变，可能需要逐级更新父结点的键值。如果某结点发生上溢，则将其分裂为两个分支数相近的结点，都作为该结点父结点的子结点，父结点也要处理可能的上溢；如果该结点为根结点，则需要创建新的根结点作为父结点。

### 删除
给定某关键字（范围），查找其下界所在的叶结点，然后沿叶结点链表顺序扫描直到完成删除。如果叶结点最大键值改变，可能需要逐级更新父结点的键值。如果某结点发生下溢，如果其为根结点，其子结点在某些情况下可能成为新的根结点；如果其左/右兄弟有多余的孩子结点，可以过继给它；否则可以将其与左/右兄弟合并成一个结点，删除或更新父结点的关键字，父结点也要处理可能的下溢。

### 更新
查找给定关键字直到恰好匹配表页号和槽号完成更新，索引结构保持不变。

{% set authors = ["孙昭言"] %}
{% include "/footer.md" %}
