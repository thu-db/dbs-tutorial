# 3.1 索引管理模块概述
索引是这样的数据结构：它以一个或多个属性的值为输入，并能快速地定位具有该值的记录的位置。索引的属性（组）称为查找键。由于索引是表的附加结构，当表的内容发生变化时，DBMS必须同步更新该表的索引。由此可见，索引虽然有助于提高查询性能，但是索引本身也会带来存储和维护开销。与表一样，一个索引结构同样存储在一个页式文件中。

本节内容对应教材《数据库系统设计与原理(第2版)》（冯建华等，清华大学出版社）第8章：索引和散列。

## 记录的组织方式
关系 (表、索引) 是记录的集合，索引中 (关键字, 表页号, 表页内槽号) 的对应关系也可以作为记录存储。以0.2提到的course表的主键id的索引为例，其一行可以分为三个定长列：(id, 表页号，表页内槽号)。

记录在关系中可以有不同的组织方式：

1. 堆文件组织：一条记录可以放在文件中的任何地方，只要那里有足够的空间存放这条记录，记录间不用考虑先后顺序的。第2节中说明的表按照这种方式组织。

2. 顺序文件组织：记录根据其"查找键"的值顺序存储。具有簇集索引的表或顺序索引自身按照这种方式组织。

3. 散列文件组织：在每条记录的某个/些属性上计算一个散列函数，根据散列的结果来确定将记录放到文件的哪个页面中。

## 索引的元数据
索引的元数据与表的元数据基本相同，可以用相同的方式处理，不过要注意存储使用索引的表。

## 主键与外键
如果主键约束作用于某列，该列不能存储NULL值，且该列的值都唯一，自动在该列上创建索引。在MySQL的InnoDB引擎（MySQL 8.0默认引擎）中，主键上的索引会被选作表的聚集索引（即教材中的“簇集索引”）；而在MyISAM引擎中，主键上的索引也仅作为辅助索引，表按照堆文件组织。在PostgreSQL中，主键上的索引不会自动作为表的聚集索引。

在MySQL中，如果外键约束作用于某列，如果不存在合适的索引，自动在该列上创建索引；在被其引用的列上必须有索引。在PostgreSQL中，外键约束不会自动在该列上创建索引；被其引用的列必须是主键或受到唯一约束，这样的列会被自动创建索引。

{% set authors = ["孙昭言"] %}
{% include "/footer.md" %}
