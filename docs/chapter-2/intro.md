# 2.1 记录管理模块概述
## 数据库文件布局
可以在根目录下创建base和global两个目录：global目录中存储一些全局的系统表，如：数据库名和数据库ID的对应关系 ([pg_database](http://www.postgres.cn/docs/9.3/catalog-pg-database.html))。在base目录中，每个数据库对应一个子目录，子目录下也可以有一些系统表，如：关系 (包括表、索引) 名和关系ID的对应关系 ([pg_class](http://www.postgres.cn/docs/9.3/catalog-pg-class.html))。子目录下的表和索引都存储在单独的文件中，子目录和文件都以其ID命名。

## 文件的组织结构
为提高存储空间利用效率和管理的灵活性，文件被划分为页面 (如：4KB) 的集合，每个页面有唯一的标识符，如：文件内字节序列以页面大小为单位从前向后标记为0号页、1号页、2号页...页面的数据区被划分为一个个插槽，每个插槽中放置一条记录。这样，<文件路径，页号，槽号> 就与记录构成了一一对应的关系。

## 表的元数据
表的元数据包括表的列数、各列的数据类型和长度、表的页数、约束 (检查约束、唯一约束、主键约束、外键约束) 等信息，可以在数据库目录下创建系统表存储 (参考[PostgreSQL的系统表](http://www.postgres.cn/docs/9.3/catalogs-overview.html))，简单的话也可以存储在表的前几页。

## 记录相关操作
1. 记录的序列化和反序列化。在字节序列和一条记录间相互转换。
2. 访问记录。根据数据库名和表名确定文件路径，根据页号和槽号找到记录的位置，通过反序列化解读出记录的内容。
3. 插入记录。先找到空闲空间，再插入记录的序列化表示；如果没有空闲空间可能需要向缓存管理模块申请新页。
4. 删除记录。先找到记录的位置，再将其删除；产生的碎片空闲空间视情况合并。
5. 更新记录。对于定长记录来说，物理组织结构不变；对于变长记录来说，与删除后插入类似。

